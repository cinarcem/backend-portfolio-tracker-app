FROM quay.io/keycloak/keycloak:25.0.4 AS builder

#ENV KEYCLOAK_ADMIN=${KEYCLOAK_ADMIN} \
#    KEYCLOAK_ADMIN_PASSWORD=${KEYCLOAK_ADMIN_PASSWORD} \
#    KC_DB=${KC_DB} \
#    KC_DB_USERNAME=${KC_DB_USERNAME} \
#    KC_DB_PASSWORD=${KC_DB_PASSWORD} \
#    KC_DB_URL=${KC_DB_URL} \
#    KC_HOSTNAME=${KC_HOSTNAME} \
#    KC_PROXY=${KC_PROXY} \
#    KC_HOSTNAME_PORT=${KC_HOSTNAME_PORT} \
#    KC_HOSTNAME_STRICT_BACKCHANNEL=${KC_HOSTNAME_STRICT_BACKCHANNEL} \
#    KC_HOSTNAME_STRICT_HTTPS=${KC_HOSTNAME_STRICT_HTTPS} \
#    KC_HTTP_ENABLED=${KC_HTTP_ENABLED} \
#    PROXY_ADDRESS_FORWARDING=${PROXY_ADDRESS_FORWARDING} \
#    QUARKUS_TRANSACTION_MANAGER_ENABLE_RECOVERY=${QUARKUS_TRANSACTION_MANAGER_ENABLE_RECOVERY}

ARG KEYCLOAK_ADMIN
ARG KEYCLOAK_ADMIN_PASSWORD
ARG KC_DB
ARG KC_DB_USERNAME
ARG KC_DB_PASSWORD
ARG KC_DB_URL
ARG KC_HOSTNAME
ARG KC_PROXY
ARG KC_HOSTNAME_PORT
ARG KC_HOSTNAME_STRICT_BACKCHANNEL
ARG KC_HOSTNAME_STRICT_HTTPS
ARG KC_HTTP_ENABLED
ARG PROXY_ADDRESS_FORWARDING
ARG QUARKUS_TRANSACTION_MANAGER_ENABLE_RECOVERY

RUN /opt/keycloak/bin/kc.sh build

FROM quay.io/keycloak/keycloak:25.0.4

COPY --from=builder /opt/keycloak/ /opt/keycloak/

ENTRYPOINT ["/opt/keycloak/bin/kc.sh"]

CMD ["start", "--optimized", "--import-realm"]